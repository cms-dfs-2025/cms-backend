# Адреса запросов к серверу

Типы JSON-объектов описаны на языке Typescript.

Фронтенд имеет путь `/`. Все адреса запросов к API сервера начинаются с
`/api/`. Сообщения ошибок от сервера содержатся в теле ответа в формате
JSON-объекта типа
```typescript
type Message =  {
    message: string
}
```

Точки во времени обозначены типом `Timestamp` и представлены строкой
[RFC3339](https://www.rfc-editor.org/rfc/rfc3339).

## Авторизация

`POST /api/auth/signup`. Создание пользователя. Запрос должен содержать информацию о
пользователе в теле в виде JSON-объекта типа
```typescript
type SignupBody =  {
    handle: string,
    password: string
}
```
Если тело запроса в некорректном формате, сервер вернет статус 400. Если
пользователь с данным `handle` уже существует, сервер вернет статус 500 и
сообщение "User already exists". Если во время создания пользователя произошла
ошибка, сервер вернет статус 500 и сообщение "Internal error". Иначе
пользователь будет создан, сервер вернет статус 200.

`POST /api/auth/login`. Проверка верности пароля. Требует авторизацию (см. ниже).
Пустой запрос. Сервер вернет статус 200.

**Авторизация.** Некоторые запросы требуют авторизацию. Это означает, что перед
обработкой запроса сервер проверяет, авторизован ли запрос. Запрос авторизован,
если он содержит заголовок
```
Authorization: Basic base64(base64(handle):password)
```
где `base64` - кодирование строки в кодировке UTF8 согласно
[RFC 4648](https://www.rfc-editor.org/rfc/rfc4648). Например, для пользователя
AzureDiamond с паролем hunter2 получим
```
handle = "AzureDiamond"
password = "hunter2"
base64(handle) = "QXp1cmVEaWFtb25k"
base64(base64(handle) + ":" + password)
    = base64("QXp1cmVEaWFtb25k:hunter2")
    = "UVhwMWNtVkVhV0Z0YjI1azpodW50ZXIy"
```
Тогда заголовок авторизации будет следующим:
```
Authorization: Basic UVhwMWNtVkVhV0Z0YjI1azpodW50ZXIy
```
Если заголовок `Authorization` отсутствует или в некорректном формате, сервер
вернет статус 401 и сообщение "Basic auth error". Если пользователь не
существует или пароль не верный, сервер вернет статус 401 и сообщение
"Unauthorized". Иначе сервер обработает запрос согласно документации. В
документации запросов, требующих авторизацию, не описаны ошибки авторизации.
Например, в документации запроса `POST /api/login` подразумевается, что сервер
вернет статус 200, *если* запрос авторизован.

`POST /api/auth/change_pw`. Смена пароля. Требует авторизацию. Запрос должен
содержать новый пароль в теле в виде JSON-объекта типа
```typescript
type ChangePwBody = {
    password: string
}
```
Если тело в некорректном формате, сервер вернет статус 400. Если во время
смены пароля произошла ошибка, сервер вернет статус 500. Иначе пароль будет
сменен, сервер вернет статус 200.

## Работа со статьями

`POST /api/work/upload`. Загрузка статьи. Требует авторизацию. Запрос должен
содержать тело в виде JSON-объекта типа
```typescript
type UploadBody = {
    title: string,
    tags: string[],
    draft: boolean,
    archived: boolean,
    body: string
}
```
Если тело в некорректном формате, сервер вернет статус 400. Если во время
загрузки статьи произошла ошибка, сервер вернет статус 500. Иначе статья будет
загружена, сервер вернет статус 200 и JSON-объект типа
```typescript
type UploadReturn = {
    id: number
}
```
содержащий присвоенный статье `id`.

`POST /api/work/modify`. Изменение статьи. Требует авторизацию. Запрос должен
содержать тело в виде JSON-объекта типа
```typescript
type ModifyBody = {
    id: number,
    title: string | null,
    tags: string[] | null,
    draft: boolean | null,
    archived: boolean | null,
    body: string | null
}
```
Если тело в некорректном формате, сервер вернет статус 400. Если статьи с `id`
не существует, сервер вернет статус 500 и сообщение "Post with id not found".
Если во время изменения статьи произошла ошибка, сервер вернет статус 500 и
сообщение "Internal error". Иначе данные статьи с соответствующим `id` будут
обновлены, сервер вернет статус 200. Будут обновлены только поля, которые имеют
значение не `null`.

`POST /api/work/delete`. Удаление статьи. Требует авторизацию. Запрос должен
содержать тело в виде JSON-объекта типа
```typescript
type DeleteBody = {
    id: number
}
```
Если тело в некорректном формате, сервер вернет статус 400. Если статьи с `id`
не существует, сервер вернет статус 500 и сообщение "Post with id not found".
Если во время удаления статьи произошла ошибка, сервер вернет статус 500 и
сообщение "Internal error". Иначе статья с соответствующим `id` будет удалена,
сервер вернет статус 200.

`GET /api/work/get_all`. Получение данных о всех статьях. Требует авторизацию.
Пустой запрос. Если во время формирования ответа произошла ошибка, сервер
вернет статус 500. Сервер вернет статус 200 и JSON-объект
```typescript
type GetAllReturn = {
    posts: PostData[]
}

type PostData = {
    id: number,
    author_handle: string,

    title: string,
    tags: string[],

    upload_timestamp: Timestamp,
    modified_timestamp: Timestamp,

    draft: boolean,
    archived: boolean
}
```

`GET /api/work/get_body`. Получение тела статьи. Требует авторизацию. Запрос
должен содержать тело в виде JSON-объекта типа
```typescript
type GetBodyBody = {
    id: number
}
```
Если тело в некорректном формате, сервер вернет статус 400. Если статьи с `id`
не существует, сервер вернет статус 404. Если во время получения статьи
произошла ошибка, сервер вернет статус 500 и сообщение. Иначе сервер вернет
статус 200 и JSON-объект
```typescript
type GetBodyReturn = {
    body: string
}
```

## Просмотр статей

`GET /api/posts/get_all`. Получение данных о всех видимых статьях. Пустой
запрос. Если во время формирования ответа произошла ошибка, сервер вернет
статус 500. Иначе сервер вернет статус 200 и JSON-объект
```typescript
type GetAllReturn = {
    posts: PostData[]
}

type PostData = {
    id: number,
    title: string,
    tags: string[]
}
```

`GET /api/posts/get_body`. Получение тела видимой статьи. Требует авторизацию.
Запрос должен содержать тело в виде JSON-объекта типа
```typescript
type GetBodyBody = {
    id: number
}
```
Если тело в некорректном формате, сервер вернет статус 400. Если видимой статьи
с `id` не существует, сервер вернет статус 404. Если во время получения статьи
произошла ошибка, сервер вернет статус 500. Иначе сервер вернет статус 200 и
JSON-объект
```typescript
type GetBodyReturn = {
    body: string
}
```
