# Документация проекта

## Запуск

Для работы требуется установить docker и docker-compose.

Перед запуском нужно создать файл `.env` и определить в нем все необходимые
переменные (см. [.env](#env)). docker-compose в первую очередь использует
переменные среды, определенные для самого процесса, а не в файле `.env`,
поэтому для работы лучше открыть свежий терминал.

Для запуска достаточно использовать `docker-compose up` или
`docker-compose up -d` для запуска в фоновом режиме.

## Архитектура

База данных состоит из docker-контейнеров, управляемых с помощью
`docker-compose` (см. файл `./docker-compose.yaml`).

### Контейнер database

Контейнер содержит postgres сервер, открытый к подключению извне контейнера на
порте `POSTGRES_CONNECT_PORT`. Пользователь, пароль и база данных определены
в соответствующих переменных среды.

Контейнер хранит данные в локальной папке `./db-data`. Если папки нет, он ее
создает и запускает скрипт `./db-init/init.sql` для инициализации базы данных.

**Схему бд** можно увидеть в `./database.dbml` или ниже

![./database.dbml](./database.png)

### Контейнер server

Контейнер содержит golang http сервер, открытый к подключению извне контейнера
на порте `SERVER_PORT`.

## .env

Перед запуском проекта нужно создать файл `.env`, в котором нужно определить
переменные
```bash
# Пароль для подключения к sql базе данных
POSTGRES_PASSWORD=

# Пользователь для подключения к sql базе данных
POSTGRES_USER=

# Название sql базы данных
POSTGRES_DBNAME=

# Порт для подключения к sql базе данных извне контейнеров
POSTGRES_CONNECT_PORT=

# Порт для подключения к серверу извне контейнеров
SERVER_PORT=
```
